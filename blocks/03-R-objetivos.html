<section class="dho-objetivos" aria-labelledby="dho-objetivos-title">
  <div class="dho-objetivos-wrap">

    <header class="dho-objetivos-header">
      <p class="dho-kicker">DIMENSÃO 1 | OBJETIVOS E PRIORIDADES DE DESENVOLVIMENTO</p>

      <h2 id="dho-objetivos-title" class="dho-title">
        Quando se sabe qual é o objetivo, o próximo passo é priorizar por onde começar.
      </h2>

      <p class="dho-subtitle">
        É unânime: 100% dos respondentes descreveram seus objetivos a serem alcançados, ou seja, todos têm um ponto de chegada claro.
        Os relatos traçam um caminho para a conquista de estabilidade (profissional, emocional e financeira) até alta realização (liderança, legado e impacto).
        Primeiro segurança, depois expansão.
        Então o que se perguntou foi: onde a energia está concentrada, e qual é o top aspecto da vida para desenvolver-se e chegar lá!
      </p>
    </header>

    <div class="dho-objetivos-grid">
      <!-- Card A: Pizza -->
      <article class="dho-card dho-card--chart" aria-label="Distribuição dos objetivos por área da vida">
        <div class="dho-card-head">
          <h3 class="dho-card-title">Em que área da vida os objetivos dos respondentes se enquadram?</h3>
        </div>

        <div class="dho-chart-row">
          <div class="dho-chart-canvas dho-plain-surface">
            <div class="dho-chart-box" aria-label="Área do gráfico">
              <canvas id="dhoObjetivosPizza" aria-label="Gráfico de pizza"></canvas>
            </div>
          </div>

          <div class="dho-legend dho-plain-surface" id="dhoObjetivosLegenda" aria-label="Legenda do gráfico"></div>
        </div>

        <p class="dho-footnote">
          A maior parte dos objetivos se concentra no campo profissional, mas há uma concentração relevante ligada a saúde, mente e equilíbrio:
          um fio condutor que começa a revelar o tema da coerência entre desempenho e qualidade de vida.
        </p>
      </article>

      <!-- Card B: Ranking -->
      <article class="dho-rank-card" aria-label="Fatores mais importantes para desenvolver">
        <div class="dho-card-head">
          <h3 class="dho-card-title">Ranking de iniciativas de desenvolvimento</h3>
          <p class="dho-card-note">
            A leitura do ranking é simples: antes de sofisticar a visão, as pessoas querem conseguir agir.
          </p>
        </div>

        <div class="dho-rank-wrap" id="dhoRankWrap">
          <ol class="dho-rank" id="dhoObjetivosRank">
            <li class="dho-rank-item dho-rank-item--top" data-rank="1">
              <span class="dho-rank-n">1</span>
              <div class="dho-rank-txt">
                <p class="dho-rank-title">Corpo e ambiente</p>
                <p class="dho-rank-desc">Condições e recursos adequados (saúde, tempo, ferramentas, rede de apoio) para agir.</p>
              </div>
            </li>

            <li class="dho-rank-item dho-rank-item--top is-hidden" data-rank="2">
              <span class="dho-rank-n">2</span>
              <div class="dho-rank-txt">
                <p class="dho-rank-title">Habilidades</p>
                <p class="dho-rank-desc">Mais conhecimento sobre si e sobre o mundo, e aplicação prática no dia a dia.</p>
              </div>
            </li>

            <li class="dho-rank-item dho-rank-item--top is-hidden" data-rank="3">
              <span class="dho-rank-n">3</span>
              <div class="dho-rank-txt">
                <p class="dho-rank-title">Comportamento</p>
                <p class="dho-rank-desc">Entender padrões que ajudam (ou travam) produtividade, consistência e novas ações.</p>
              </div>
            </li>

            <li class="dho-rank-item is-hidden" data-rank="4">
              <span class="dho-rank-n">4</span>
              <div class="dho-rank-txt">
                <p class="dho-rank-title">Crenças e valores</p>
                <p class="dho-rank-desc">Clarear o que se acredita e valoriza para agir com coerência.</p>
              </div>
            </li>

            <li class="dho-rank-item is-hidden" data-rank="5">
              <span class="dho-rank-n">5</span>
              <div class="dho-rank-txt">
                <p class="dho-rank-title">Visão e missão</p>
                <p class="dho-rank-desc">Definir propósito, futuro desejado e escolher como viver isso.</p>
              </div>
            </li>

            <li class="dho-rank-item is-hidden" data-rank="6">
              <span class="dho-rank-n">6</span>
              <div class="dho-rank-txt">
                <p class="dho-rank-title">Legado</p>
                <p class="dho-rank-desc">Gerar impacto positivo e duradouro em pessoas, times e sociedade.</p>
              </div>
            </li>

            <li class="dho-rank-item is-hidden" data-rank="7">
              <span class="dho-rank-n">7</span>
              <div class="dho-rank-txt">
                <p class="dho-rank-title">Identidade</p>
                <p class="dho-rank-desc">Compreender papéis e expressão autêntica de quem se é.</p>
              </div>
            </li>
          </ol>

          <div class="dho-rank-cta">
            <button class="dho-btn dho-btn--glow" id="dhoRankNextBtn" type="button">
              Descobrir o Top 2
            </button>
            <p class="dho-rank-hint" id="dhoRankHint">
              Dica: clique para abrir o próximo nível do ranking.
            </p>

            <div class="dho-rank-final" id="dhoRankFinal" aria-live="polite">
              <p class="dho-rank-final-q">
                E para você, qual é seu Top 1 hoje para o seu desenvolvimento?
              </p>
            </div>
          </div>
        </div>
      </article>

      <!-- Card C: Reflexões -->
      <aside class="dho-insight-box dho-insight-box--flow" aria-label="Reflexão orientada pelos dados">
        <h3 class="dho-flow-title">Reflexão</h3>

        <p class="dho-flow-top">
          A pesquisa revela que os profissionais no geral priorizam desenvolver condições, habilidades e comportamento
          antes de refinar sua visão. Eles preferem aplicar esforços para agir efetivamente.
        </p>

        <img class="dho-flow-img" src="assets/fluxodedesenvolvimento.png" alt="Fluxo de desenvolvimento">

        <p class="dho-flow-bottom">
          Ou seja, esta sequência sugere que para chegar lá, os primeiros passos devem ser desenvolver corpo/ambiente,
          habilidades e comportamento para tornar possível o alcance da coerência na relação de trabalho.
        </p>
      </aside>
    </div>

  </div>
</section>

<style>
  .dho-objetivos { padding: 28px 16px; }
  .dho-objetivos-wrap { max-width: 980px; margin: 0 auto; }

  .dho-kicker{
    margin: 0 0 10px 0;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    font-size: 12px;
    color: rgba(255,255,255,0.70);
  }

  .dho-title{
    margin: 0 0 10px 0;
    font-size: clamp(22px, 2.3vw, 34px);
    line-height: 1.15;
    color: #F5F5F7;
    font-weight: 700;
  }

  .dho-subtitle{
    margin: 0;
    max-width: 980px;
    font-size: 15.5px;
    line-height: 1.65;
    color: rgba(255,255,255,0.85);
    text-align: justify;
  }

  .dho-objetivos-grid{
    margin-top: 18px;
    display: grid;
    grid-template-columns: 1.05fr 0.95fr;
    gap: 14px;
    align-items: start;
  }

  .dho-card{
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(255,255,255,0.07);
    border-radius: 18px;
    padding: 14px 14px 12px 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
  }

  .dho-card::before{
    content: "";
    position: absolute;
    inset: -1px;
    background:
      radial-gradient(900px 280px at 20% 0%, rgba(180,130,255,0.14), transparent 60%),
      radial-gradient(700px 260px at 80% 20%, rgba(130,160,255,0.10), transparent 55%);
    pointer-events: none;
    opacity: 0.9;
  }

  .dho-card > *{ position: relative; z-index: 1; }
  .dho-card-head{ margin-bottom: 10px; }

  .dho-card-title{
    margin: 0 0 6px 0;
    font-size: 16px;
    font-weight: 700;
    color: #F5F5F7;
    letter-spacing: 0.01em;
  }

  .dho-card-note{
    margin: 0;
    font-size: 13.5px;
    line-height: 1.55;
    color: rgba(255,255,255,0.70);
    text-align: justify;
  }

  .dho-plain-surface{
    border: 0 !important;
    background: transparent !important;
    padding: 0 !important;
    border-radius: 0 !important;
    height: auto;
    box-shadow: none !important;
  }

  /* ====== CHART: dimensões estáveis (sem “faixa amarela”) ====== */
  .dho-objetivos{
    --pizzaSize: 260px;   /* desktop */
    --chartGap: 22px;
    --legendMax: 420px;
  }

  .dho-chart-row{
    display: grid;
    grid-template-columns: var(--pizzaSize) 1fr;
    gap: var(--chartGap);
    align-items: center;        /* corta o vazio */
    padding-top: 4px;
  }

  .dho-chart-canvas{
    display: grid;
    justify-items: start;       /* aproxima da esquerda (linha azul) */
    align-items: center;
  }

  .dho-chart-box{
    width: var(--pizzaSize);
    height: var(--pizzaSize);   /* chave: remove min-height + trava altura real */
    position: relative;
    margin: 0;                  /* sem centralizar */
  }

  #dhoObjetivosPizza{
    position: absolute;
    inset: 0;
    width: 100% !important;
    height: 100% !important;
    display: block;
  }

  /* Legenda em LISTA vertical alinhada (linha vermelha) */
  #dhoObjetivosLegenda{
    display: grid;
    grid-template-columns: 1fr;
    row-gap: 12px;
    align-content: start;
    justify-self: start;
    max-width: var(--legendMax);
  }

  .dho-legend-item{
    display: grid;
    grid-template-columns: 10px 1fr auto;
    gap: 10px;
    align-items: start;
    padding: 0;                /* sem “altura extra” */
  }

  .dho-legend-item + .dho-legend-item{
    border-top: 0 !important;  /* sem divisórias, como lista limpa */
    margin-top: 0 !important;
    padding-top: 0 !important;
  }

  .dho-legend-dot{
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-top: 4px;
    box-shadow: 0 0 0 2px rgba(255,255,255,0.08);
  }

  .dho-legend-label{
    font-size: 13.5px;
    line-height: 1.35;
    color: rgba(255,255,255,0.85);
    margin: 0;
  }

  .dho-legend-sub{
    font-size: 12px;
    line-height: 1.35;
    color: rgba(255,255,255,0.70);
    margin: 2px 0 0 0;
    text-align: justify;
  }

  .dho-legend-pct{
    font-variant-numeric: tabular-nums;
    font-weight: 700;
    color: #F5F5F7;
    font-size: 13.5px;
    opacity: 0.95;
  }

  .dho-footnote{
    margin: 8px 0 0 0;   /* reduz altura “amarela” */
    font-size: 12.8px;
    line-height: 1.55;
    color: rgba(255,255,255,0.80);
    text-align: justify;
  }

  /* ===== Ranking e resto: mantidos ===== */
  .dho-rank-card{
    border: 0;
    background: transparent;
    border-radius: 0;
    padding: 0;
    box-shadow: none;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    position: relative;
    overflow: visible;
    grid-column: 1 / -1;
  }

  .dho-rank-wrap{ margin-top: 10px; }

  .dho-rank{
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    gap: 8px;
  }

  .dho-rank-item{
    display: grid;
    grid-template-columns: 30px 1fr;
    gap: 10px;
    padding: 10px 10px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(0,0,0,0.12);
  }

  .dho-rank-item--top{
    border-color: rgba(255,255,255,0.14);
    background: linear-gradient(180deg, rgba(180,130,255,0.10), rgba(0,0,0,0.12));
  }

  .dho-rank-n{
    width: 28px;
    height: 28px;
    border-radius: 10px;
    display: grid;
    place-items: center;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.06);
    color: rgba(255,255,255,0.92);
    font-weight: 700;
    font-variant-numeric: tabular-nums;
  }

  .dho-rank-title{
    margin: 0;
    font-size: 13.5px;
    font-weight: 700;
    color: rgba(255,255,255,0.92);
  }

  .dho-rank-desc{
    margin: 3px 0 0 0;
    font-size: 12.8px;
    line-height: 1.45;
    color: rgba(255,255,255,0.70);
    text-align: justify;
  }

  .is-hidden{ display: none !important; }

  .dho-rank-cta{
    margin-top: 10px;
    display: grid;
    gap: 6px;
  }

  .dho-btn{
    width: 100%;
    border: 1px solid rgba(206, 182, 255, 0.26);
    border-radius: 14px;
    padding: 11px 12px;
    font-weight: 800;
    letter-spacing: 0.01em;
    cursor: pointer;
    color: rgba(255,255,255,0.94);
    background: rgba(165, 125, 255, 0.16);
    box-shadow: 0 10px 24px rgba(0,0,0,0.22);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    transition: transform 0.12s ease, background 0.12s ease, border-color 0.12s ease;
    position: relative;
    overflow: hidden;
  }

  .dho-btn:hover{
    transform: translateY(-1px);
    background: rgba(175, 140, 255, 0.20);
    border-color: rgba(220, 200, 255, 0.34);
  }

  .dho-btn:active{ transform: translateY(0px); }

  .dho-btn:disabled{
    cursor: default;
    opacity: 0.70;
    transform: none;
  }

  .dho-btn--glow::after{
    content: "";
    position: absolute;
    inset: -40%;
    background: linear-gradient(
      110deg,
      transparent 0%,
      rgba(245, 235, 255, 0.06) 35%,
      rgba(245, 235, 255, 0.22) 50%,
      rgba(245, 235, 255, 0.06) 65%,
      transparent 100%
    );
    transform: translateX(-55%) rotate(8deg);
    animation: dhoShimmer 3.6s ease-in-out infinite;
    pointer-events: none;
  }

  @keyframes dhoShimmer{
    0%   { transform: translateX(-60%) rotate(8deg); opacity: 0.0; }
    18%  { opacity: 0.55; }
    50%  { transform: translateX(60%) rotate(8deg); opacity: 0.35; }
    100% { transform: translateX(60%) rotate(8deg); opacity: 0.0; }
  }

  @media (prefers-reduced-motion: reduce){
    .dho-btn--glow::after{ animation: none; }
  }

  .dho-rank-hint{
    margin: 0;
    font-size: 12.5px;
    line-height: 1.45;
    color: rgba(255,255,255,0.70);
    text-align: justify;
  }

  .dho-rank-final{
    display: none;
    width: 40%;
    margin: 12px auto 0 auto;
    border: 0;
    border-radius: 6px;
    padding: 10px 12px;
    background: rgba(255,255,255,0.16);
    text-align: center;
  }

  .dho-rank-final.is-visible{ display: block; }

  .dho-rank-final-q{
    margin: 0;
    font-size: 14px;
    line-height: 1.45;
    color: rgba(10,10,14,0.92);
    font-weight: 800;
    text-align: center;
  }

  .dho-insight-box--flow{
    background: transparent !important;
    border-color: transparent !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    grid-column: 1 / -1;
  }

  .dho-flow-img{ display:block; width:100%; height:auto; margin:16px auto; }

  .dho-flow-title{
    margin: 0 0 10px 0;
    font-size: 26px;
    font-weight: 800;
    letter-spacing: 0.02em;
    color: rgba(232, 202, 255, 0.95);
  }

  .dho-flow-top,
  .dho-flow-bottom{
    margin: 0 auto;
    max-width: 860px;
    font-size: 15px;
    line-height: 1.6;
    color: rgba(255,255,255,0.90);
    text-align: justify;
  }

  /* Layout geral */
  .dho-objetivos-header{ position: static !important; }

  .dho-card--chart{ grid-column: 1 / -1; justify-self: center; width: min(860px, 100%); }
  .dho-rank-card{ grid-column: 1 / -1; justify-self: center; width: min(750px, 100%); }
  .dho-rank-card .dho-card-head{ text-align:center; }

  /* ===== Mobile / tablet ===== */
  @media (max-width: 920px){
    .dho-objetivos{ --pizzaSize: 240px; --legendMax: 100%; --chartGap: 12px; }
    .dho-objetivos-grid{ grid-template-columns: 1fr; }
    .dho-chart-row{
      grid-template-columns: 1fr;
      align-items: start;
    }
    .dho-chart-canvas{ justify-items: center; }
    .dho-chart-box{ margin: 0 auto; }
    .dho-rank-final{ width: 100%; }
  }

  @media (max-width: 520px){
    .dho-objetivos{ --pizzaSize: 220px; }
  }
</style>

<script>
  window.initBloco_objetivos = function initBloco_objetivos() {
    try {
      const root = document.querySelector(".dho-objetivos");
      if (!root) return;

      // ========= util: carregar Chart.js com fallback =========
      const ensureChart = () => new Promise((resolve) => {
        if (window.Chart) return resolve(true);

        if (window.__dhoChartLoading === true) {
          const t = setInterval(() => {
            if (window.Chart) { clearInterval(t); resolve(true); }
          }, 60);
          setTimeout(() => { clearInterval(t); resolve(!!window.Chart); }, 2500);
          return;
        }

        window.__dhoChartLoading = true;

        const s = document.createElement("script");
        s.src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js";
        s.async = true;
        s.onload = () => resolve(true);
        s.onerror = () => resolve(false);
        document.head.appendChild(s);
      });

      // ========= 1) Pizza =========
      const renderPizza = () => {
        const dataPizza = [
          { label: "Trabalho e carreira", sub: "carreira, propósito, renda", value: 45, color: "rgba(180,130,255,0.95)" },
          { label: "Autodesenvolvimento e saúde", sub: "saúde, intelecto, equilíbrio emocional", value: 28, color: "rgba(150,170,255,0.92)" },
          { label: "Bem-estar e sentido", sub: "hobbies, felicidade, espiritualidade", value: 17, color: "rgba(210,170,255,0.85)" },
          { label: "Relações", sub: "família, social, conjugal", value: 10, color: "rgba(255,255,255,0.72)" }
        ];

        const legendaEl = root.querySelector("#dhoObjetivosLegenda");
        if (legendaEl) {
          legendaEl.innerHTML = dataPizza.map(item => `
            <div class="dho-legend-item">
              <span class="dho-legend-dot" style="background:${item.color}"></span>
              <div>
                <p class="dho-legend-label">${item.label}</p>
                <p class="dho-legend-sub">${item.sub}</p>
              </div>
              <div class="dho-legend-pct">${item.value}%</div>
            </div>
          `).join("");
        }

        const canvas = root.querySelector("#dhoObjetivosPizza");
        if (!canvas) return;

        canvas.removeAttribute("width");
        canvas.removeAttribute("height");

        if (canvas._chartInstance) canvas._chartInstance.destroy();

        const ctx = canvas.getContext("2d");
        const chart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: dataPizza.map(d => d.label),
            datasets: [{
              data: dataPizza.map(d => d.value),
              backgroundColor: dataPizza.map(d => d.color),
              borderColor: "rgba(255,255,255,0.10)",
              borderWidth: 1.2,
              hoverOffset: 6
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: "62%",
            animation: { duration: 650 },
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: "rgba(10,10,14,0.92)",
                borderColor: "rgba(255,255,255,0.10)",
                borderWidth: 1,
                titleColor: "rgba(255,255,255,0.92)",
                bodyColor: "rgba(255,255,255,0.85)",
                padding: 10,
                callbacks: { label: (context) => ` ${context.raw}%` }
              }
            }
          }
        });

        canvas._chartInstance = chart;

        const force = () => { try { chart.resize(); } catch(e){} };
        requestAnimationFrame(force);
        setTimeout(force, 80);
        setTimeout(force, 260);
      };

      // ========= 2) Ranking progressivo =========
      const wrap = root.querySelector("#dhoRankWrap");
      const btn  = root.querySelector("#dhoRankNextBtn");
      const hint = root.querySelector("#dhoRankHint");
      const list = root.querySelector("#dhoObjetivosRank");
      const finalBox = root.querySelector("#dhoRankFinal");

      if (wrap && btn && list) {
        const items = Array.from(list.querySelectorAll(".dho-rank-item"));
        items.forEach(li => {
          const r = li.getAttribute("data-rank");
          if (r !== "1") li.classList.add("is-hidden");
          else li.classList.remove("is-hidden");
        });

        if (finalBox) finalBox.classList.remove("is-visible");
        btn.disabled = false;
        btn.classList.add("dho-btn--glow");

        const getNextHidden = () => list.querySelector(".dho-rank-item.is-hidden");

        const syncButtonLabel = () => {
          const nextHidden = getNextHidden();
          if (nextHidden) {
            const nextRank = nextHidden.getAttribute("data-rank");
            btn.textContent = `Descobrir o Top ${nextRank}`;
            if (hint) hint.textContent = "Dica: clique para abrir o próximo nível do ranking.";
            return;
          }
          btn.textContent = "Ranking completo";
          btn.disabled = true;
          btn.classList.remove("dho-btn--glow");
          if (hint) hint.textContent = "Pronto: agora o ranking está totalmente aberto.";
          if (finalBox) finalBox.classList.add("is-visible");
        };

        if (wrap.dataset.bound !== "1") {
          wrap.dataset.bound = "1";
          btn.addEventListener("click", () => {
            const hidden = getNextHidden();
            if (!hidden) return;
            hidden.classList.remove("is-hidden");
            syncButtonLabel();
          });
        }

        syncButtonLabel();
      }

      ensureChart().then((ok) => {
        if (!ok) {
          console.warn("[Bloco objetivos] Não foi possível carregar Chart.js (CDN bloqueado).");
          return;
        }
        renderPizza();
      });

    } catch (err) {
      console.error("[Bloco objetivos] Erro ao inicializar:", err);
    }
  };
</script>
