<section class="dho-objetivosneg" aria-labelledby="dho-objetivosneg-title">
  <div class="dho-objetivosneg-wrap">
    <header class="dho-objetivosneg-header">
      <p class="dho-kicker">DIMENSÃO 2 | OBJETIVOS DO NEGÓCIO</p>
      <h2 id="dho-objetivosneg-title">Para onde o negócio quer ir e o que pode travar o caminho</h2>
      <p class="dho-subtitle">
        Este recorte reúne duas camadas que caminham juntas: a direção desejada para os próximos meses e os pontos internos que podem reduzir a velocidade da entrega.
      </p>
    </header>

    <!-- ATO 1 | DIREÇÃO -->
    <section class="dho-ato" aria-label="Direção do negócio">
      <div class="dho-ato-head">
        <h3 class="dho-ato-title">Direção percebida</h3>
        <p class="dho-ato-lead">
          Quando o negócio fala sobre futuro, três eixos aparecem com mais presença: sustentação financeira, maturidade de liderança e impacto positivo. É um norte que combina resultado com construção.
        </p>
      </div>

      <div class="dho-eixos" role="list" aria-label="Principais eixos percebidos">
        <div class="dho-eixo" role="listitem">
          <p><strong>Sustentação financeira</strong> como horizonte, com desejo de ampliar conforto, segurança e autonomia no médio prazo.</p>
        </div>
        <div class="dho-eixo" role="listitem">
          <p><strong>Maturidade de liderança</strong>, reconhecendo que crescer exige lidar com complexidade, pessoas e prioridades.</p>
        </div>
        <div class="dho-eixo" role="listitem">
          <p><strong>Impacto humano</strong>, com vontade de contribuir para a vida de outras pessoas por meio do trabalho.</p>
        </div>
      </div>
    </section>

    <!-- ATO 2 | TOP OBJETIVOS (BARRAS VERTICAIS TOP 5) -->
    <section class="dho-ato" aria-label="Prioridades estratégicas nos próximos 12 meses">
      <div class="dho-ato-head">
        <h3 class="dho-ato-title">Prioridades estratégicas nos próximos 12 meses</h3>
        <p class="dho-ato-lead">
          As prioridades se concentram em crescimento e tração comercial, com atenção também a bases que sustentam a operação, como caixa, eficiência e pessoas.
        </p>
      </div>

      <div class="dho-chart-block" aria-label="Gráfico de prioridades mais citadas">
        <div class="dho-chart-head">
          <div class="dho-chart-title">Top 5 prioridades mais citadas</div>
          <div class="dho-legend" id="dho-objetivosneg-legend-top"></div>
        </div>

        <div class="dho-chart-area dho-chart-area-top">
          <canvas id="dho-objetivosneg-top5" aria-label="Gráfico de barras verticais com top 5 prioridades" role="img"></canvas>
        </div>

        <div class="dho-footnote">
          <p class="dho-note">
            Observação: as demais prioridades tiveram 1 menção cada e aparecem como nota complementar abaixo.
          </p>
        </div>

        <div class="dho-nota-compl" aria-label="Prioridades com 1 menção">
          <h4 class="dho-nota-title">Menções pontuais (1 cada)</h4>
          <p class="dho-nota-text">
            Retenção de clientes e customer success; Talentos, liderança e sucessão; Digitalização e automação de processos; Expansão geográfica ou novos mercados.
          </p>
        </div>
      </div>
    </section>

    <!-- ATO 3 | PREPARAÇÃO (LIMITAR A 850px) -->
    <section class="dho-ato" aria-label="Preparação para entregar as prioridades">
      <div class="dho-ato-head">
        <h3 class="dho-ato-title">Preparação para entregar as prioridades</h3>
        <p class="dho-ato-lead">
          Ao avaliar recursos e planos, o quadro sugere uma base bem encaminhada. A diferença aparece quando o tema é acompanhamento contínuo, cadência e indicadores.
        </p>
      </div>

      <div class="dho-prep-wrap" aria-label="Tabela de preparação e maturidade">
        <div class="dho-prep-legend" aria-label="Legenda de níveis de maturidade">
          <p class="dho-note">
            Escala de maturidade: 1 não temos nada planejado; 2 há rascunhos ou ideias soltas; 3 plano parcial com pontos em aberto; 4 plano quase pronto com recursos encaminhados; 5 totalmente pronto, recursos assegurados e pronto para executar.
          </p>
        </div>

        <div class="dho-prep">
          <div class="dho-prep-row">
            <div class="dho-prep-item">
              <div class="dho-prep-name">Plano tático (MVP, etapas, datas, responsáveis)</div>
              <div class="dho-prep-desc">Plano completo, pronto para executar</div>
            </div>
            <div class="dho-scale" aria-label="Maturidade 5 de 5" data-score="5" data-max="5">
              <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
            </div>
            <div class="dho-prep-score">5</div>
          </div>

          <div class="dho-prep-row">
            <div class="dho-prep-item">
              <div class="dho-prep-name">Recursos financeiros</div>
              <div class="dho-prep-desc">Quase pronto, recursos encaminhados</div>
            </div>
            <div class="dho-scale" aria-label="Maturidade 4 de 5" data-score="4" data-max="5">
              <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
            </div>
            <div class="dho-prep-score">4</div>
          </div>

          <div class="dho-prep-row">
            <div class="dho-prep-item">
              <div class="dho-prep-name">Força de trabalho e clareza de competências críticas</div>
              <div class="dho-prep-desc">Quase pronto, recursos encaminhados</div>
            </div>
            <div class="dho-scale" aria-label="Maturidade 4 de 5" data-score="4" data-max="5">
              <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
            </div>
            <div class="dho-prep-score">4</div>
          </div>

          <div class="dho-prep-row">
            <div class="dho-prep-item">
              <div class="dho-prep-name">Infraestrutura, ferramentas e tecnologia</div>
              <div class="dho-prep-desc">Quase pronto, recursos encaminhados</div>
            </div>
            <div class="dho-scale" aria-label="Maturidade 4 de 5" data-score="4" data-max="5">
              <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
            </div>
            <div class="dho-prep-score">4</div>
          </div>

          <div class="dho-prep-row">
            <div class="dho-prep-item">
              <div class="dho-prep-name">Parcerias e fornecedores críticos</div>
              <div class="dho-prep-desc">Quase pronto, recursos encaminhados</div>
            </div>
            <div class="dho-scale" aria-label="Maturidade 4 de 5" data-score="4" data-max="5">
              <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
            </div>
            <div class="dho-prep-score">4</div>
          </div>

          <div class="dho-prep-row">
            <div class="dho-prep-item">
              <div class="dho-prep-name">Mapa de riscos e planos de contingência</div>
              <div class="dho-prep-desc">Quase pronto, recursos encaminhados</div>
            </div>
            <div class="dho-scale" aria-label="Maturidade 4 de 5" data-score="4" data-max="5">
              <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
            </div>
            <div class="dho-prep-score">4</div>
          </div>

          <div class="dho-prep-row">
            <div class="dho-prep-item">
              <div class="dho-prep-name">Governança e agendas de acompanhamento (metas e indicadores)</div>
              <div class="dho-prep-desc">Plano parcial, com pontos em aberto</div>
            </div>
            <div class="dho-scale" aria-label="Maturidade 3 de 5" data-score="3" data-max="5">
              <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
            </div>
            <div class="dho-prep-score">3</div>
          </div>
        </div>

        <div class="dho-card" role="note" aria-label="Insight editorial sobre preparação">
          <h4 class="dho-card-title">Insight</h4>
          <p class="dho-card-text">
            A preparação aponta solidez para começar. O ponto sensível não está no plano em si, mas na disciplina de acompanhamento: cadência, indicadores e decisões de ajuste ao longo do caminho.
          </p>
        </div>

        <p class="dho-transition">
          Quando o objetivo está claro e os recursos começam a se organizar, a pergunta muda: o que pode impedir a entrega?
        </p>
      </div>
    </section>

    <!-- ATO 4 | BARREIRAS (AJUSTE PARA 850px) -->
    <section class="dho-ato" aria-label="Barreiras da força de trabalho que podem comprometer a entrega">
      <div class="dho-ato-head">
        <h3 class="dho-ato-title">O que pode comprometer a entrega</h3>
        <p class="dho-ato-lead">
          Entre os fatores ligados à força de trabalho, os sinais mais fortes aparecem em alinhamento do dia a dia, preparação de liderança e foco. O recorte considera a percepção do público de negócios e também a visão de líderes.
        </p>
      </div>

      <div class="dho-barreiras-wrap" aria-label="Container de barreiras com largura controlada">
        <div class="dho-chart-block">
          <div class="dho-chart-head">
            <div class="dho-chart-title">Fatores mais citados</div>
            <div class="dho-legend" id="dho-objetivosneg-legend"></div>
          </div>

          <div class="dho-chart-area">
            <canvas id="dho-objetivosneg-barreiras" aria-label="Gráfico de barras horizontais com fatores mais citados" role="img"></canvas>
          </div>

          <div class="dho-footnote">
            <p class="dho-note">
              Observação: os valores representam menções totais por fator. A leitura é indicativa, dado o volume reduzido de respostas.
            </p>
          </div>
        </div>

        <div class="dho-card" role="note" aria-label="Insight editorial sobre barreiras">
          <h4 class="dho-card-title">Insight</h4>
          <p class="dho-card-text">
            O movimento é claro: o risco maior não parece ser a falta de intenção, e sim o atrito cotidiano. Alinhamento, liderança e priorização tendem a decidir se a estratégia vira entrega.
          </p>
        </div>
      </div>
    </section>
  </div>

  <style>
    .dho-objetivosneg { padding: 34px 18px 26px; }
    .dho-objetivosneg-wrap { max-width: 980px; margin: 0 auto; }
    .dho-objetivosneg-header { margin-bottom: 18px; }

    .dho-kicker {
      margin: 0 0 8px 0;
      font-size: 12px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.70);
    }

    .dho-objetivosneg h2 {
      margin: 0 0 10px 0;
      font-size: 28px;
      line-height: 1.15;
      color: rgba(255,255,255,0.96);
    }

    .dho-subtitle {
      margin: 0;
      max-width: 920px;
      color: rgba(255,255,255,0.85);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.55;
      font-size: 15px;
    }

    .dho-ato {
      margin-top: 18px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,0.10);
    }

    .dho-ato-head { display: grid; gap: 8px; margin-bottom: 12px; }
    .dho-ato-title { margin: 0; font-size: 18px; color: rgba(255,255,255,0.96); }

    .dho-ato-lead {
      margin: 0;
      color: rgba(255,255,255,0.85);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.55;
      font-size: 14px;
      max-width: 980px;
    }

    .dho-eixos {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px 14px;
      margin-top: 10px;
    }

    .dho-eixo {
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      border-radius: 14px;
      padding: 12px 14px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 26px rgba(0,0,0,0.18);
    }

    .dho-eixo p {
      margin: 0;
      color: rgba(255,255,255,0.85);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.55;
      font-size: 14px;
    }

    .dho-eixo strong { color: rgba(255,255,255,0.96); font-weight: 600; }

    .dho-chart-block {
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      border-radius: 18px;
      padding: 14px 14px 10px;
      backdrop-filter: blur(12px);
      box-shadow: 0 12px 34px rgba(0,0,0,0.18);
    }

    .dho-chart-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .dho-chart-title { color: rgba(255,255,255,0.96); font-weight: 650; font-size: 14px; }

    .dho-legend {
      display: flex;
      align-items: center;
      gap: 10px;
      color: rgba(255,255,255,0.70);
      font-size: 12px;
      white-space: nowrap;
    }

    .dho-legend .swatch {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.18);
      display: inline-block;
      margin-right: 6px;
    }

    .dho-chart-area { position: relative; height: 320px; }
    .dho-chart-area-top { height: 280px; }

    .dho-footnote .dho-note { margin: 10px 0 0 0; }

    .dho-note {
      margin: 10px 0 0 0;
      color: rgba(255,255,255,0.70);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.5;
      font-size: 13px;
    }

    .dho-nota-compl {
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      border-radius: 14px;
      padding: 12px 14px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 26px rgba(0,0,0,0.14);
    }

    .dho-nota-title {
      margin: 0 0 6px 0;
      color: rgba(255,255,255,0.70);
      font-size: 12px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .dho-nota-text {
      margin: 0;
      color: rgba(255,255,255,0.85);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.55;
      font-size: 13.5px;
    }

    /* Preparação com largura 850px */
    .dho-prep-wrap { max-width: 850px; margin: 0 auto; }
    .dho-prep-legend { margin-top: 6px; margin-bottom: 10px; }
    .dho-prep { display: grid; gap: 10px; margin-top: 10px; }

    .dho-prep-row {
      display: grid;
      grid-template-columns: 1fr auto 24px;
      gap: 12px;
      align-items: center;
      padding: 12px 12px;
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 14px;
      background: rgba(255,255,255,0.03);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 26px rgba(0,0,0,0.16);
    }

    .dho-prep-name { color: rgba(255,255,255,0.96); font-weight: 600; font-size: 13px; margin-bottom: 4px; }

    .dho-prep-desc {
      color: rgba(255,255,255,0.70);
      font-size: 12.5px;
      line-height: 1.35;
      text-align: justify;
      text-justify: inter-word;
      max-width: 820px;
    }

    .dho-scale {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      justify-content: flex-end;
      min-width: 132px;
    }

    .dho-scale .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      box-shadow: 0 6px 14px rgba(0,0,0,0.16);
    }

    .dho-prep-score { color: rgba(255,255,255,0.70); font-size: 13px; font-weight: 700; text-align: right; }

    .dho-card {
      margin-top: 12px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.07);
      border-radius: 16px;
      padding: 14px 16px;
      backdrop-filter: blur(12px);
      box-shadow: 0 14px 36px rgba(0,0,0,0.22);
    }

    .dho-card-title {
      margin: 0 0 6px 0;
      color: rgba(255,255,255,0.96);
      font-size: 13px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .dho-card-text {
      margin: 0;
      color: rgba(255,255,255,0.85);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.55;
      font-size: 14px;
    }

    .dho-transition {
      margin: 12px 0 0 0;
      color: rgba(255,255,255,0.85);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.55;
      font-size: 14px;
    }

    /* (NOVO) Barreiras com largura 850px */
    .dho-barreiras-wrap {
      max-width: 850px;
      margin: 0 auto;
    }

    @media (max-width: 980px) {
      .dho-objetivosneg h2 { font-size: 24px; }
    }

    @media (max-width: 880px) {
      .dho-eixos { grid-template-columns: 1fr; }
      .dho-chart-area { height: 340px; }
      .dho-chart-area-top { height: 320px; }
    }

    @media (max-width: 620px) {
      .dho-prep-row { grid-template-columns: 1fr; gap: 10px; align-items: start; }
      .dho-scale { justify-content: flex-start; }
      .dho-prep-score { text-align: left; }
    }
  </style>

  <script>
    window.initBloco_objetivosNeg = async function initBloco_objetivosNeg() {
      const root = document.querySelector(".dho-objetivosneg");
      if (!root) return;

      // Pintar escalas (dots) conforme score
      root.querySelectorAll(".dho-scale").forEach((el) => {
        const score = Number(el.getAttribute("data-score") || "0");
        const dots = Array.from(el.querySelectorAll(".dot"));
        dots.forEach((d, idx) => {
          const active = idx < score;
          d.style.background = active ? "rgba(255,255,255,0.18)" : "rgba(255,255,255,0.03)";
          d.style.borderColor = active ? "rgba(255,255,255,0.16)" : "rgba(255,255,255,0.10)";
        });
      });

      // Legendas customizadas (sem legenda padrão do Chart.js)
      const legendTop = document.getElementById("dho-objetivosneg-legend-top");
      if (legendTop) legendTop.innerHTML = '<span class="swatch" aria-hidden="true"></span><span>Contagem de menções</span>';

      const legendBar = document.getElementById("dho-objetivosneg-legend");
      if (legendBar) legendBar.innerHTML = '<span class="swatch" aria-hidden="true"></span><span>Total de menções</span>';

      // Carregar Chart.js se necessário
      async function ensureChartJs() {
        if (window.Chart) return true;

        return new Promise((resolve) => {
          const existing = document.querySelector('script[data-dho-chartjs="1"]');
          if (existing) {
            existing.addEventListener("load", () => resolve(true));
            existing.addEventListener("error", () => resolve(false));
            return;
          }

          const s = document.createElement("script");
          s.src = "https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js";
          s.async = true;
          s.setAttribute("data-dho-chartjs", "1");
          s.onload = () => resolve(true);
          s.onerror = () => resolve(false);
          document.head.appendChild(s);
        });
      }

      const ok = await ensureChartJs();
      if (!ok) return;

      // TOP 5 prioridades (barras verticais)
      const topCanvas = document.getElementById("dho-objetivosneg-top5");
      if (topCanvas) {
        const top5 = [
          { objetivo: "Aquisição de clientes e novos canais", qtd: 3 },
          { objetivo: "Crescimento de receita orgânica", qtd: 3 },
          { objetivo: "Caixa e capital de giro", qtd: 2 },
          { objetivo: "Lucratividade e eficiência operacional", qtd: 2 },
          { objetivo: "Lançamento de novos produtos ou serviços", qtd: 1 }
        ];

        if (window.__dhoObjetivosNegTop5 && typeof window.__dhoObjetivosNegTop5.destroy === "function") {
          window.__dhoObjetivosNegTop5.destroy();
        }

        const tctx = topCanvas.getContext("2d");
        window.__dhoObjetivosNegTop5 = new window.Chart(tctx, {
          type: "bar",
          data: {
            labels: top5.map(d => d.objetivo),
            datasets: [{
              label: "Menções",
              data: top5.map(d => d.qtd),
              borderWidth: 1,
              borderColor: "rgba(255,255,255,0.18)",
              backgroundColor: "rgba(255,255,255,0.16)",
              borderRadius: 12,
              barThickness: 34
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: { callbacks: { label: (ctx) => ` ${ctx.parsed.y} menções` } }
            },
            scales: {
              x: {
                ticks: {
                  color: "rgba(255,255,255,0.70)",
                  maxRotation: 0,
                  minRotation: 0,
                  callback: function(value) {
                    const label = this.getLabelForValue(value) || "";
                    const parts = label.split(" ");
                    const cut = parts.length > 4 ? 4 : Math.max(2, Math.floor(parts.length / 2));
                    return parts.slice(0, cut).join(" ") + (parts.length > cut ? "..." : "");
                  }
                },
                grid: { display: false },
                border: { color: "rgba(255,255,255,0.10)" }
              },
              y: {
                beginAtZero: true,
                ticks: { color: "rgba(255,255,255,0.70)", precision: 0, stepSize: 1 },
                grid: { color: "rgba(255,255,255,0.08)" },
                border: { color: "rgba(255,255,255,0.10)" }
              }
            }
          }
        });
      }

      // Barreiras (barras horizontais)
      const canvas = document.getElementById("dho-objetivosneg-barreiras");
      if (!canvas) return;

      const data = [
        { fator: "Comunicação e processos desalinhados", total: 3 },
        { fator: "Liderança não preparada", total: 3 },
        { fator: "Saída de talentos e rotatividade", total: 2 },
        { fator: "Excesso de iniciativas, pouca priorização", total: 2 },
        { fator: "Falta de capacitação técnica", total: 2 },
        { fator: "Absenteísmo e licenças não planejadas", total: 1 },
        { fator: "Sobrecarga e risco de burnout", total: 1 },
        { fator: "Baixo espírito de equipe", total: 1 },
        { fator: "Competências comportamentais", total: 1 }
      ];

      data.sort((a, b) => (b.total - a.total) || a.fator.localeCompare(b.fator, "pt-BR"));

      const labels = data.map(d => d.fator);
      const values = data.map(d => d.total);

      if (window.__dhoObjetivosNegChart && typeof window.__dhoObjetivosNegChart.destroy === "function") {
        window.__dhoObjetivosNegChart.destroy();
      }

      const ctx = canvas.getContext("2d");
      window.__dhoObjetivosNegChart = new window.Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "Total de menções",
            data: values,
            borderWidth: 1,
            borderColor: "rgba(255,255,255,0.18)",
            backgroundColor: "rgba(255,255,255,0.16)",
            borderRadius: 10,
            barThickness: 16
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: "y",
          plugins: {
            legend: { display: false },
            tooltip: { callbacks: { label: (ctx) => ` ${ctx.parsed.x} menções` } }
          },
          scales: {
            x: {
              beginAtZero: true,
              ticks: { color: "rgba(255,255,255,0.70)", precision: 0, stepSize: 1 },
              grid: { color: "rgba(255,255,255,0.08)" },
              border: { color: "rgba(255,255,255,0.10)" }
            },
            y: {
              ticks: { color: "rgba(255,255,255,0.85)", font: { size: 12 } },
              grid: { display: false },
              border: { color: "rgba(255,255,255,0.10)" }
            }
          }
        }
      });
    };
  </script>
</section>
