<section class="dho-met" aria-labelledby="dho-met-title">
  <div class="dho-met-wrap">

    <header class="dho-met-header">
      <h2 id="dho-met-title" class="dho-met-title">Metodologia</h2>

      <p class="dho-met-subtitle" id="dhoMetIntro">
        Este piloto combinou survey e entrevistas para capturar sinais iniciais, padrões recorrentes e hipóteses de desenvolvimento a serem aprofundadas na próxima fase.
      </p>
    </header>

    <div class="dho-met-kpis" role="list">
      <article class="dho-met-card" role="listitem">
        <p class="dho-met-card-label">Respondentes totais</p>
        <div class="dho-met-number">32</div>
        <p class="dho-met-small">
          Survey: <strong>29</strong> <span class="dho-met-dot">•</span> Entrevistas: <strong>3</strong>
        </p>
      </article>

      <article class="dho-met-card" role="listitem">
        <p class="dho-met-card-label">Dimensões Criticas</p>

        <div class="dho-met-inflexao-hero" aria-label="Resumo das temáticas do piloto">
          <div class="dho-met-inflexao-hero-num">10</div>
          <div class="dho-met-inflexao-hero-right">
            <div class="dho-met-inflexao-hero-title">temáticas</div>
            <div class="dho-met-inflexao-hero-desc">
              Organizadas para analisar as Dimensões Criticas.
            </div>
          </div>
        </div>
      </article>

      <article class="dho-met-card" role="listitem">
        <p class="dho-met-card-label">Abordagens metodológicas</p>
        <ul class="dho-met-bullets" aria-label="Componentes do piloto">
          <li><strong>Survey</strong> para escala e foco</li>
          <li><strong>Entrevistas</strong> para contexto e nuances</li>
          <li><strong>Checagens</strong> para refinar hipóteses</li>
        </ul>
        <p class="dho-met-small dho-met-muted">
          Combinação para priorizar a qualidade.
        </p>
      </article>
    </div>

    <div class="dho-met-grid">
      <article class="dho-met-panel">
        <div class="dho-met-panel-head">
          <h3 class="dho-met-h3">Composição da amostra</h3>
          <p class="dho-met-p">Distribuição por público (PRO, LID, NEG, RH).</p>
        </div>

        <div class="dho-met-comp">
          <div class="dho-met-comp-chart">
            <div class="dho-met-chart dho-met-chart-donut">
              <canvas id="dhoChartAmostraDonut" role="img" aria-label="Gráfico donut: composição da amostra"></canvas>
            </div>
          </div>

          <div class="dho-met-keylist" aria-label="Legenda do gráfico: composição da amostra">
            <div class="dho-met-keyitem dho-met-pro">
              <div class="dho-met-keyleft">
                <span class="dho-met-keysq dho-met-sw-pro" aria-hidden="true"></span>
                <span class="dho-met-keyname">Profissionais no geral</span>
                <span class="dho-met-keytag">(PRO)</span>
              </div>
              <span class="dho-met-keyval">56%</span>
            </div>

            <div class="dho-met-keyitem dho-met-lid">
              <div class="dho-met-keyleft">
                <span class="dho-met-keysq dho-met-sw-lid" aria-hidden="true"></span>
                <span class="dho-met-keyname">Lideranças</span>
                <span class="dho-met-keytag">(LID)</span>
              </div>
              <span class="dho-met-keyval">19%</span>
            </div>

            <div class="dho-met-keyitem dho-met-neg">
              <div class="dho-met-keyleft">
                <span class="dho-met-keysq dho-met-sw-neg" aria-hidden="true"></span>
                <span class="dho-met-keyname">Negócios</span>
                <span class="dho-met-keytag">(NEG)</span>
              </div>
              <span class="dho-met-keyval">19%</span>
            </div>

            <div class="dho-met-keyitem dho-met-rh">
              <div class="dho-met-keyleft">
                <span class="dho-met-keysq dho-met-sw-rh" aria-hidden="true"></span>
                <span class="dho-met-keyname">Recursos Humanos</span>
                <span class="dho-met-keytag">(RH)</span>
              </div>
              <span class="dho-met-keyval">6%</span>
            </div>
          </div>
        </div>
      </article>

      <article class="dho-met-panel">
        <div class="dho-met-panel-head">
          <h3 class="dho-met-h3">Situação de trabalho dos respondentes</h3>
          <p class="dho-met-p">Contexto atual no momento da pesquisa.</p>
        </div>

        <div class="dho-met-chart dho-met-chart-bar">
          <canvas id="dhoChartTrabalhoBar" role="img" aria-label="Gráfico barras: situação de trabalho"></canvas>
        </div>

        <p class="dho-met-note">
          Nota: o “n” pode variar por pergunta. Os resultados devem ser aproveitados qualitativamente como bússola para identificar pontos de inflexão e hipóteses, e não como conclusão definitiva.
        </p>
      </article>
    </div>

    <details class="dho-met-details">
      <summary class="dho-met-summary">
        <span>Por que o RH participou pouco da pesquisa?</span>
        <span class="dho-met-summary-icon" aria-hidden="true"></span>
      </summary>

      <div class="dho-met-details-body">
        <div class="dho-met-rh-enunciado" aria-label="Enunciado da checagem complementar">
          Em resposta à baixa adesão de RH no piloto, realizamos uma checagem complementar no LinkedIn. Objetivo: entender barreiras de engajamento e ajustar a estratégia de amostragem na próxima fase.
        </div>

        <div class="dho-met-rh-toprow" aria-label="Métricas e nota">
          <div class="dho-met-rh-metricas" role="list" aria-label="Métricas da checagem no LinkedIn">
            <div class="dho-met-rh-metrica" role="listitem">
              <div class="dho-met-rh-metrica-num">100</div>
              <div class="dho-met-rh-metrica-label">Abordagens no LinkedIn</div>
            </div>

            <div class="dho-met-rh-metrica" role="listitem">
              <div class="dho-met-rh-metrica-num">9</div>
              <div class="dho-met-rh-metrica-label">Devolutivas recebidas</div>
            </div>
          </div>

          <aside class="dho-met-rh-nota" aria-label="Nota sobre o perfil de quem respondeu">
            <div class="dho-met-rh-nota-kicker">Nota</div>
            <div class="dho-met-rh-nota-text">A maior parte dos retornos veio de Chefes de RH.</div>
          </aside>
        </div>

        <h4 class="dho-met-rh-subtitle">
          O que os profissionais que retornaram relataram
        </h4>

        <div class="dho-met-rh-feedbacks" aria-label="Feedbacks qualitativos">
          <div class="dho-met-rh-feedback">
            Há percepção recorrente de excesso de abordagens comerciais, o que faz com que propostas de cooperação legítimas sejam descartadas já na primeira impressão.
          </div>

          <div class="dho-met-rh-feedback">
            A rotina é descrita como intensa e reativa, com pouco tempo disponível para iniciativas de comunidade e para o aprofundamento de boas práticas de gestão de pessoas.
          </div>

          <div class="dho-met-rh-feedback">
            Profissionais mais seniores tendem a participar de grupos menores e bem curados de networking, preservando a qualidade das trocas e evitando dinâmicas de interesse puramente comercial.
          </div>

          <div class="dho-met-rh-feedback">
            Também aparece a frustração com pesquisas que não devolvem resultados prometidos, o que reduz a disposição para se engajar nas próximas iniciativas.
          </div>
        </div>
      </div>
    </details>

  </div>
</section>

<style>
  .dho-met{
    --bg0: #23142f;
    --bg1: #2a1637;

    /* ✅ AJUSTE: uniformiza a área clara com a escura (remove a sensação de “faixa” mais clara) */
    --wrapTop: rgba(255,255,255,0.06);
    --wrapBot: rgba(255,255,255,0.06);

    --card: rgba(255,255,255,0.06);
    --card2: rgba(255,255,255,0.08);
    --stroke: rgba(255,255,255,0.10);
    --text: rgba(255,255,255,0.92);
    --muted: rgba(255,255,255,0.72);
    --muted2: rgba(255,255,255,0.60);

    --pro: #c08ad6;
    --lid: #8d5aa6;
    --neg: #5b2e73;
    --rh:  #e2c6ec;

    --radius: 18px;
    --shadow: 0 14px 40px rgba(0,0,0,0.25);

    padding: 24px 16px;
  }

  .dho-met *{ box-sizing: border-box; }

  .dho-met .dho-met-wrap{
    max-width: 980px;
    margin: 0 auto;
    background: linear-gradient(180deg, var(--wrapTop), var(--wrapBot));
    border: 1px solid var(--stroke);
    border-radius: 22px;
    box-shadow: var(--shadow);
    padding: 24px 20px 18px;
    color: var(--text);
    backdrop-filter: blur(6px);
  }

  /* ✅ AJUSTE PRINCIPAL: header sem “caixa” própria (fica igual ao fundo do wrap) */
  .dho-met .dho-met-header{
    background: none !important;
    border: none !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    padding: 0 !important;
    margin-bottom: 14px;
  }

  .dho-met .dho-met-title{
    margin: 0;
    font-size: 34px;
    line-height: 1.12;
    letter-spacing: -0.02em;
    color: var(--text);
  }

  .dho-met .dho-met-subtitle{
    margin: 10px 0 0;
    max-width: none;
    width: 100%;
    color: var(--muted);
    font-size: 14px;
    line-height: 1.55;
  }

  .dho-met .dho-met-kpis{
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 12px;
    margin: 14px 0 12px;
  }

  .dho-met .dho-met-card{
    border: 1px solid var(--stroke);
    border-radius: var(--radius);
    background: var(--card);
    padding: 14px 14px 12px;
    min-height: 118px;
  }
  .dho-met .dho-met-card:nth-child(1){ grid-column: span 4; }
  .dho-met .dho-met-card:nth-child(2){ grid-column: span 4; }
  .dho-met .dho-met-card:nth-child(3){ grid-column: span 4; }

  .dho-met .dho-met-card-label{ margin: 0; font-size: 13px; color: var(--muted); }
  .dho-met .dho-met-number{ margin-top: 10px; font-size: 44px; font-weight: 800; letter-spacing: -0.03em; }
  .dho-met .dho-met-small{ margin: 8px 0 0; font-size: 13px; color: var(--muted); line-height: 1.45; }
  .dho-met .dho-met-dot{ margin: 0 6px; color: var(--muted2); }
  .dho-met .dho-met-muted{ color: var(--muted2); }

  .dho-met .dho-met-inflexao-hero{
    margin-top: -6px;
    padding: 12px 12px;
    border-radius: 14px;
    border: 0px solid rgba(255,255,255,0.10);
    background: transparent;
    display: grid;
    grid-template-columns: 72px 1fr;
    gap: 12px;
    align-items: center;
  }

  .dho-met .dho-met-inflexao-hero-num{
    font-size: 44px;
    font-weight: 900;
    letter-spacing: -0.04em;
    line-height: 1;
  }

  .dho-met .dho-met-inflexao-hero-title{
    font-size: 14px;
    letter-spacing: 0.10em;
    text-transform: uppercase;
    color: var(--muted2);
    margin-bottom: 6px;
  }

  .dho-met .dho-met-inflexao-hero-desc{
    font-size: 13px;
    color: var(--muted);
    line-height: 1.45;
  }

  .dho-met .dho-met-bullets{
    margin: 10px 0 0;
    padding-left: 18px;
    color: var(--muted);
    font-size: 13px;
    line-height: 1.5;
  }
  .dho-met .dho-met-bullets li{ margin: 6px 0; }

  .dho-met .dho-met-grid{
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 12px;
    margin-top: 10px;
  }

  .dho-met .dho-met-panel{
    grid-column: span 6;
    border: 1px solid var(--stroke);
    border-radius: var(--radius);
    background: var(--card2);
    padding: 16px 14px 14px;
  }

  .dho-met .dho-met-panel-head{ margin-bottom: 10px; }
  .dho-met .dho-met-h3{ margin: 0; font-size: 16px; letter-spacing: -0.01em; }
  .dho-met .dho-met-p{ margin: 6px 0 0; font-size: 13px; color: var(--muted); line-height: 1.5; }

  .dho-met .dho-met-comp{ margin-top: 10px; }

  .dho-met .dho-met-comp-chart{
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 8px 0 10px;
  }

  .dho-met .dho-met-chart{
    width: 100%;
    position: relative;
  }

  .dho-met .dho-met-chart-donut{
    height: 240px;
    max-width: 360px;
  }

  .dho-met .dho-met-chart-bar{ height: 300px; }

  .dho-met canvas{
    display: block;
    width: 100% !important;
    height: 100% !important;
  }

  .dho-met .dho-met-keylist{
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
    margin-top: 8px;
  }

  .dho-met .dho-met-keyitem{
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    padding: 9px 9px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(0,0,0,0.10);
  }

  .dho-met .dho-met-keyleft{
    display: flex;
    align-items: baseline;
    gap: 6px;
    min-width: 0;
  }

  .dho-met .dho-met-keysq{
    width: 11px;
    height: 11px;
    border-radius: 4px;
    flex: 0 0 11px;
    margin-right: 2px;
  }

  .dho-met .dho-met-keyname{
    font-size: 12px;
    color: var(--text);
    font-weight: 650;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .dho-met .dho-met-keytag{
    font-size: 11px;
    color: var(--muted2);
    white-space: nowrap;
  }

  .dho-met .dho-met-keyval{
    font-size: 13px;
    font-weight: 850;
    letter-spacing: -0.01em;
    white-space: nowrap;
  }

  .dho-met .dho-met-pro{ border-left: 3px solid var(--pro); }
  .dho-met .dho-met-lid{ border-left: 3px solid var(--lid); }
  .dho-met .dho-met-neg{ border-left: 3px solid var(--neg); }
  .dho-met .dho-met-rh{  border-left: 3px solid var(--rh);  }

  .dho-met .dho-met-sw-pro{ background: var(--pro); }
  .dho-met .dho-met-sw-lid{ background: var(--lid); }
  .dho-met .dho-met-sw-neg{ background: var(--neg); }
  .dho-met .dho-met-sw-rh{  background: var(--rh);  }

  .dho-met .dho-met-note{
    margin: 10px 0 0;
    font-size: 12px;
    color: var(--muted2);
    line-height: 1.5;
  }

  .dho-met .dho-met-details{
    margin-top: 12px;
    border: 1px solid var(--stroke);
    border-radius: var(--radius);
    background: rgba(255,255,255,0.06);
    overflow: hidden;
  }

  .dho-met .dho-met-summary{
    list-style: none;
    cursor: pointer;
    padding: 14px 14px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    font-weight: 700;
    font-size: 14px;
    user-select: none;
  }

  .dho-met .dho-met-summary::-webkit-details-marker{ display: none; }

  .dho-met .dho-met-summary-icon{
    width: 30px;
    height: 30px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(0,0,0,0.12);
    position: relative;
    flex: 0 0 30px;
  }

  .dho-met .dho-met-summary-icon::before,
  .dho-met .dho-met-summary-icon::after{
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 12px;
    height: 2px;
    background: rgba(255,255,255,0.85);
    transform: translate(-50%, -50%);
  }

  .dho-met .dho-met-summary-icon::after{
    transform: translate(-50%, -50%) rotate(90deg);
  }

  .dho-met details[open] .dho-met-summary-icon::after{ opacity: 0; }

  .dho-met .dho-met-details-body{
    border-top: 1px solid rgba(255,255,255,0.10);
    padding: 14px 14px 14px;
  }

  .dho-met .dho-met-rh-enunciado{
    width: 100%;
    padding: 0;
    border: none;
    background: transparent;
    border-radius: 0;
    box-shadow: none;
    font-size: 13px;
    color: var(--muted);
    line-height: 1.55;
  }

  .dho-met .dho-met-rh-toprow{
    display: grid;
    grid-template-columns: 1fr 0.9fr;
    gap: 12px;
    align-items: center;
    margin-top: 12px;
  }

  .dho-met .dho-met-rh-metricas{
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 16px;
    align-items: center;
  }

  .dho-met .dho-met-rh-metrica{
    border: none;
    background: transparent;
    border-radius: 0;
    padding: 0;
    text-align: center;
  }

  .dho-met .dho-met-rh-metrica-num{
    font-size: 34px;
    font-weight: 950;
    letter-spacing: -0.03em;
    line-height: 1.05;
    background: linear-gradient(90deg, var(--pro), var(--rh));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .dho-met .dho-met-rh-metrica-label{
    margin-top: 6px;
    font-size: 12px;
    color: var(--muted2);
    line-height: 1.35;
  }

  .dho-met .dho-met-rh-nota{
    border: none;
    background: transparent;
    padding: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 6px;
  }

  .dho-met .dho-met-rh-nota-kicker{
    font-size: 12px;
    letter-spacing: 0.10em;
    text-transform: uppercase;
    color: var(--muted2);
    font-weight: 850;
  }

  .dho-met .dho-met-rh-nota-text{
    font-size: 13px;
    color: var(--muted);
    line-height: 1.5;
  }

  .dho-met .dho-met-rh-subtitle{
    margin: 16px 0 10px;
    font-size: 14px;
    font-weight: 750;
    letter-spacing: -0.01em;
    color: var(--text);
  }

  .dho-met .dho-met-rh-feedbacks{
    margin-top: 0;
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
  }

  .dho-met .dho-met-rh-feedback{
    border: 1px solid rgba(192,138,214,0.35);
    background: linear-gradient(
      135deg,
      rgba(192,138,214,0.10),
      rgba(226,198,236,0.06)
    );
    border-radius: 16px;
    padding: 14px 14px;
    font-size: 13px;
    color: var(--text);
    line-height: 1.6;
  }

  @media (max-width: 680px){
    .dho-met .dho-met-subtitle{
      text-align: justify;
      text-justify: inter-word;
    }
    .dho-met .dho-met-keylist{
      grid-template-columns: 1fr;
    }
    .dho-met .dho-met-rh-toprow{
      grid-template-columns: 1fr;
      align-items: start;
    }
    .dho-met .dho-met-rh-metricas{
      grid-template-columns: repeat(2, minmax(0, 1fr));
      justify-items: center;
      gap: 12px;
    }
    .dho-met .dho-met-rh-feedbacks{
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 980px){
    .dho-met .dho-met-card:nth-child(1),
    .dho-met .dho-met-card:nth-child(2),
    .dho-met .dho-met-card:nth-child(3){ grid-column: span 12; }
    .dho-met .dho-met-panel{ grid-column: span 12; }
    .dho-met .dho-met-chart-bar{ height: 280px; }
  }
</style>

<script>
  function ensureChartJS(){
    if (window.Chart) return Promise.resolve();
    if (window.__dhoChartJsPromise) return window.__dhoChartJsPromise;

    window.__dhoChartJsPromise = new Promise((resolve, reject) => {
      const s = document.createElement("script");
      s.src = "https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js";
      s.async = true;
      s.onload = () => resolve();
      s.onerror = () => reject(new Error("Falha ao carregar Chart.js"));
      document.head.appendChild(s);
    });

    return window.__dhoChartJsPromise;
  }

  function readMetColors(root){
    const css = getComputedStyle(root);
    const get = (v, fb) => (css.getPropertyValue(v).trim() || fb);

    return {
      pro: get("--pro", "#c08ad6"),
      lid: get("--lid", "#8d5aa6"),
      neg: get("--neg", "#5b2e73"),
      rh:  get("--rh",  "#e2c6ec"),
      muted: get("--muted2", "rgba(255,255,255,0.60)"),
      grid: "rgba(255,255,255,0.10)"
    };
  }

  function destroyIfAny(canvas){
    const prev = canvas && canvas.__chartInstance;
    if (prev && typeof prev.destroy === "function") {
      prev.destroy();
      canvas.__chartInstance = null;
    }
  }

  window.initBloco_metodologia = async function(){
    const root = document.querySelector(".dho-met");
    if(!root) return;

    const donutEl = root.querySelector("#dhoChartAmostraDonut");
    const barEl   = root.querySelector("#dhoChartTrabalhoBar");
    if(!donutEl || !barEl) return;

    if (donutEl.__chartInstance && barEl.__chartInstance) return;

    await ensureChartJS();

    destroyIfAny(donutEl);
    destroyIfAny(barEl);

    const colors = readMetColors(root);

    donutEl.__chartInstance = new Chart(donutEl, {
      type: "doughnut",
      data: {
        labels: ["PRO", "LID", "NEG", "RH"],
        datasets: [{
          data: [56, 19, 19, 6],
          backgroundColor: [colors.pro, colors.lid, colors.neg, colors.rh],
          borderWidth: 0,
          hoverOffset: 6,
          cutout: "62%"
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: { label: (ctx) => `${ctx.label}: ${ctx.parsed}%` }
          }
        }
      }
    });

    barEl.__chartInstance = new Chart(barEl, {
      type: "bar",
      data: {
        labels: [
          "Empregado regime CLT",
          "Empregado regime PJ",
          "Implantando meu próprio negócio",
          "Autônomo",
          "Em busca de recolocação",
          "Desempregado"
        ],
        datasets: [{
          label: "Percentual",
          data: [41, 19, 16, 9, 9, 6],
          borderWidth: 0,
          borderRadius: 10,
          backgroundColor: colors.pro
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        indexAxis: "y",
        scales: {
          x: {
            beginAtZero: true,
            max: 50,
            grid: { color: colors.grid },
            ticks: { color: colors.muted, callback: (v) => v + "%" }
          },
          y: {
            grid: { display: false },
            ticks: { color: colors.muted }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: { callbacks: { label: (ctx) => ctx.parsed.x + "%" } }
        }
      }
    });
  };
</script>
