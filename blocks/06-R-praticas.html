
<section class="dho-praticas" aria-labelledby="dho-praticas-title">
  <div class="dho-praticas-wrap">
    <!-- 1) Header editorial -->
    <header class="dho-praticas-head">
      <div class="dho-praticas-kicker">DIMENSÃO X</div>
      <h2 id="dho-praticas-title">Práticas de gestão e liderança de pessoas</h2>
      <p class="dho-praticas-sub">
        Entre promover e aplicar, existe um espaço onde a estratégia se perde ou se sustenta. Nesta dimensão, as práticas
        são observadas por múltiplas perspectivas para evidenciar consistência, lacunas e oportunidades de sustentação no dia a dia.
      </p>

      <div class="dho-praticas-insight">
        <div class="insight-badge">Insight</div>
        <p class="insight-text">
          A maturidade não está na existência das práticas, mas na consistência da aplicação.
        </p>
      </div>
    </header>

    <!-- 2) Como ler -->
    <div class="dho-praticas-guide card">
      <h3 class="h3">Como ler esta dimensão</h3>
      <ul class="guide-list">
        <li><span class="tag">RH promove</span> o quanto as práticas são promovidas institucionalmente na companhia atual.</li>
        <li><span class="tag">Liderança aplica</span> o quanto as práticas são efetivamente aplicadas no cotidiano da gestão.</li>
        <li><span class="tag">Trajetória</span> o quanto as práticas são conhecidas e já foram vivenciadas (duas lentes: Negócio e RH).</li>
      </ul>
      <p class="guide-note">
        A leitura não é sobre “certo” ou “errado”. É sobre coerência: quando a execução aperta, quais práticas resistem e quais viram esforço individual.
      </p>
    </div>

    <!-- 3) Núcleo: Heatmap comparativo -->
    <div class="dho-praticas-core">
      <div class="core-top">
        <div>
          <h3 class="h3">Heatmap comparativo</h3>
          <p class="core-desc">
            Tons mais claros indicam maior nível (1 a 5). O objetivo é tornar visível onde há promoção e conhecimento, mas a aplicação oscila.
          </p>
        </div>

        <div class="view-toggle" role="tablist" aria-label="Filtro de trajetória">
          <button class="toggle-btn is-active" type="button" data-view="traj_avg" role="tab" aria-selected="true">
            Trajetória (média)
          </button>
          <button class="toggle-btn" type="button" data-view="traj_neg" role="tab" aria-selected="false">
            Trajetória (Negócio)
          </button>
          <button class="toggle-btn" type="button" data-view="traj_rh" role="tab" aria-selected="false">
            Trajetória (RH)
          </button>
        </div>
      </div>

      <div class="heatwrap">
        <div class="heat-head">
          <div class="heat-th col-pratica">Prática</div>
          <div class="heat-th">RH promove</div>
          <div class="heat-th">Liderança aplica</div>
          <div class="heat-th">Trajetória</div>
          <div class="heat-th col-gap">Gap</div>
        </div>
        <div id="dho-praticas-heat" class="heat-body" aria-label="Heatmap de práticas"></div>

        <div class="legend">
          <div class="legend-row">
            <span class="legend-label">Baixo (1)</span>
            <span class="swatch s1" aria-hidden="true"></span>
            <span class="swatch s2" aria-hidden="true"></span>
            <span class="swatch s3" aria-hidden="true"></span>
            <span class="swatch s4" aria-hidden="true"></span>
            <span class="swatch s5" aria-hidden="true"></span>
            <span class="legend-label">Alto (5)</span>
          </div>
          <p class="legend-note">
            Gap = Trajetória (conhecimento e vivência) menos Liderança aplica. Quanto maior, maior a chance de existir método, mas faltar sustentação no contexto atual.
          </p>
        </div>
      </div>
    </div>

    <!-- 4) Leitura guiada -->
    <div class="dho-praticas-reading">
      <div class="reading-text">
        <h3 class="h3">Leitura guiada</h3>
        <p>
          O padrão geral sugere que o conhecimento existe e as práticas são reconhecidas como importantes. O ponto sensível aparece na transição entre
          intenção e rotina: quando não há sistema (rituais, cadência, métricas simples e espaço na agenda), a aplicação tende a depender do perfil individual
          de cada liderança.
        </p>
        <div class="reading-callout">
          <div class="callout-dot" aria-hidden="true"></div>
          <p class="callout-text"><strong>Conhecimento não é o gargalo.</strong> O gargalo é a consistência sob pressão operacional.</p>
        </div>
      </div>

      <div class="reading-list card">
        <h4 class="h4">Maiores gaps de sustentação</h4>
        <div id="dho-praticas-gaps" class="gaps-list" aria-label="Lista de maiores gaps"></div>
        <p class="note">
          Este recorte prioriza onde a trajetória indica maturidade, mas a aplicação atual não acompanha na mesma intensidade.
        </p>
      </div>
    </div>

    <!-- 5) Recorte por perspectiva -->
    <div class="dho-praticas-perspectives">
      <div class="persp-grid">
        <div class="persp card">
          <h4 class="h4">O olhar do RH</h4>
          <p>
            O RH sinaliza promoção moderada de práticas essenciais, mas parte do conjunto aparece com baixa sustentação.
            O risco não está no desenho das iniciativas, e sim na aderência cotidiana e no espaço real na agenda.
          </p>
          <p class="mini">
            Mini insight: promover não garante aplicação.
          </p>
        </div>

        <div class="persp card">
          <h4 class="h4">O olhar do negócio</h4>
          <p>
            A trajetória do negócio mostra alta valorização e vivência ampla das práticas. Em outras palavras: existe apetite por bons rituais de gestão.
            Quando a aplicação cai, a fricção tende a estar no contexto (prioridade, tempo, governança), não na relevância do tema.
          </p>
          <p class="mini">
            Mini insight: existe expectativa de que funcione.
          </p>
        </div>

        <div class="persp card">
          <h4 class="h4">A prática da liderança</h4>
          <p>
            A liderança reporta aplicação estável, mas com pouca diferenciação entre práticas. Isso pode indicar padronização mínima (o básico acontece)
            e, ao mesmo tempo, espaço para elevar profundidade em temas como desenvolvimento, mentoria e gestão contínua.
          </p>
          <p class="mini">
            Mini insight: sem sistema, a prática vira esforço individual.
          </p>
        </div>
      </div>
    </div>

    <!-- 6) Síntese visual -->
    <div class="dho-praticas-synth">
      <div class="synth-strip">
        <div class="synth-step">
          <span class="synth-k">RH promove</span>
          <span class="synth-v" id="synth-rh">-</span>
        </div>
        <div class="synth-arrow" aria-hidden="true">→</div>
        <div class="synth-step">
          <span class="synth-k">Trajetória</span>
          <span class="synth-v" id="synth-traj">-</span>
        </div>
        <div class="synth-arrow" aria-hidden="true">→</div>
        <div class="synth-step">
          <span class="synth-k">Liderança aplica</span>
          <span class="synth-v" id="synth-lid">-</span>
        </div>
        <div class="synth-note">
          <p>
            Esta dimensão revela menos um problema de intenção e mais um desafio de sustentação.
          </p>
        </div>
      </div>
    </div>

    <!-- 7) Conexão com negócio -->
    <div class="dho-praticas-bridge">
      <h3 class="h3">Ponte estratégica</h3>
      <p>
        Em ambientes de crescimento acelerado e baixa maturidade de governança, práticas de gestão de pessoas tendem a perder espaço para urgências operacionais.
        O efeito costuma ser cumulativo: menos cadência, menos feedback estruturado, menos desenvolvimento, e mais dependência do “heroísmo” individual.
      </p>
      <div class="bridge-em">
        <span class="bridge-icon" aria-hidden="true">◈</span>
        <p><strong>Quando a execução aperta, o humano é o primeiro a ser comprimido.</strong></p>
      </div>
    </div>

    <!-- 8) Reflexão -->
    <div class="dho-praticas-reflection">
      <h3 class="h3">Reflexão DHO 360</h3>
      <p>
        Gestão de pessoas não falha por falta de método. Ela falha quando não encontra espaço, prioridade e coerência com o modelo de negócio.
        A diferença entre “ter” e “ser” uma prática está no ritual: o que acontece toda semana, mesmo com o calendário cheio.
      </p>
    </div>

    <!-- 9) CTA editorial -->
    <div class="dho-praticas-cta card">
      <h3 class="h3">Pergunta para fechar</h3>
      <p>
        O que hoje impede boas práticas de se sustentarem no seu dia a dia: falta de tempo, falta de clareza, falta de ritual ou falta de prioridade?
      </p>
    </div>
  </div>

  <style>
    /* =========================
       DHO 360 | Bloco: Práticas
       ========================= */
    .dho-praticas{
      position: relative;
      padding: 22px 0 28px;
    }
    .dho-praticas-wrap{
      max-width: 1040px;
      margin: 0 auto;
      padding: 0 18px;
    }

    /* Paleta e base */
    .dho-praticas{
      --fg: rgba(255,255,255,0.96);
      --sub: rgba(255,255,255,0.85);
      --muted: rgba(255,255,255,0.70);
      --stroke: rgba(255,255,255,0.10);
      --card: rgba(255,255,255,0.07);
      --card2: rgba(255,255,255,0.06);
      --shadow: 0 10px 26px rgba(0,0,0,.34);
      --blur: blur(10px);

      --v1: rgba(124,58,237,0.22);
      --v2: rgba(168,85,247,0.22);
      --v3: rgba(233,213,255,0.18);

      --h1: 22px;
      --h2: 16px;
      --p: 14.5px;
      --small: 12.5px;

      color: var(--sub);
    }

    /* Tipografia */
    .dho-praticas h2,
    .dho-praticas .h3,
    .dho-praticas .h4{
      color: var(--fg);
      margin: 0 0 8px 0;
      letter-spacing: 0.2px;
    }
    .dho-praticas h2{
      font-size: clamp(20px, 2vw, 26px);
      line-height: 1.18;
      font-weight: 760;
    }
    .dho-praticas .h3{
      font-size: 16px;
      font-weight: 720;
      line-height: 1.25;
    }
    .dho-praticas .h4{
      font-size: 14px;
      font-weight: 720;
      line-height: 1.25;
    }
    .dho-praticas p{
      margin: 0 0 10px 0;
      font-size: var(--p);
      line-height: 1.6;
      text-align: justify; /* Regra obrigatória */
      text-justify: inter-word;
    }

    /* Cards */
    .dho-praticas .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 14px;
      box-shadow: var(--shadow);
      backdrop-filter: var(--blur);
      -webkit-backdrop-filter: var(--blur);
      padding: 14px 16px;
    }

    /* Header */
    .dho-praticas-head{
      margin-bottom: 14px;
    }
    .dho-praticas-kicker{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      margin-bottom: 10px;
      border: 1px solid var(--stroke);
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(124,58,237,0.16), rgba(168,85,247,0.10));
      color: var(--muted);
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }
    .dho-praticas-sub{
      color: var(--sub);
      margin-top: 8px;
      max-width: 980px;
    }
    .dho-praticas-insight{
      margin-top: 12px;
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 10px;
      align-items: start;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: linear-gradient(135deg, rgba(124,58,237,0.12), rgba(233,213,255,0.06));
    }
    .insight-badge{
      font-size: 12px;
      letter-spacing: .06em;
      text-transform: uppercase;
      color: var(--muted);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.14);
      white-space: nowrap;
      margin-top: 1px;
    }
    .insight-text{
      margin: 0;
      color: var(--fg);
    }

    /* Guide */
    .dho-praticas-guide{
      margin: 14px 0;
    }
    .guide-list{
      margin: 10px 0 8px 0;
      padding-left: 18px;
    }
    .guide-list li{
      margin: 8px 0;
      font-size: var(--p);
      line-height: 1.55;
      color: var(--sub);
      text-align: justify; /* regra */
      text-justify: inter-word;
    }
    .tag{
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border: 1px solid var(--stroke);
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      background: rgba(0,0,0,0.12);
      margin-right: 6px;
      white-space: nowrap;
    }
    .guide-note{
      color: var(--muted);
      margin-top: 8px;
      font-size: var(--small);
    }

    /* Core */
    .dho-praticas-core{
      margin-top: 10px;
    }
    .core-top{
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: start;
      margin: 8px 0 10px;
    }
    .core-desc{
      color: var(--muted);
      margin-top: 2px;
      font-size: var(--small);
    }
    .view-toggle{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .toggle-btn{
      appearance: none;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.14);
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12.5px;
      letter-spacing: .02em;
      cursor: pointer;
      transition: transform .08s ease, background .2s ease, color .2s ease;
    }
    .toggle-btn:hover{ transform: translateY(-1px); }
    .toggle-btn.is-active{
      color: var(--fg);
      background: linear-gradient(135deg, rgba(124,58,237,0.18), rgba(168,85,247,0.10));
    }

    /* Heatmap container */
    .heatwrap{
      border: 1px solid var(--stroke);
      border-radius: 16px;
      background: rgba(255,255,255,0.03);
      box-shadow: 0 12px 28px rgba(0,0,0,.28);
      overflow: hidden;
    }
    .heat-head{
      display: grid;
      grid-template-columns: 1.6fr 0.7fr 0.9fr 0.8fr 0.55fr;
      gap: 0;
      border-bottom: 1px solid var(--stroke);
      background: linear-gradient(135deg, rgba(124,58,237,0.10), rgba(0,0,0,0.12));
    }
    .heat-th{
      padding: 10px 10px;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .08em;
      text-transform: uppercase;
      border-right: 1px solid rgba(255,255,255,0.06);
      text-align: left;
    }
    .heat-th:last-child{ border-right: none; }

    .heat-body .row{
      display: grid;
      grid-template-columns: 1.6fr 0.7fr 0.9fr 0.8fr 0.55fr;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.10);
    }
    .heat-body .row:last-child{ border-bottom: none; }

    .cell{
      padding: 10px 10px;
      border-right: 1px solid rgba(255,255,255,0.06);
      display: flex;
      align-items: center;
      gap: 10px;
      min-height: 44px;
    }
    .cell:last-child{ border-right: none; }

    .pratica{
      color: var(--fg);
      font-size: 13.5px;
      line-height: 1.25;
      text-align: left;
      font-weight: 640;
    }
    .heatbox{
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.03);
    }
    .heatbox .val{
      font-size: 13px;
      color: var(--fg);
      font-weight: 720;
    }
    .heatbox .lab{
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .02em;
      text-align: left;
    }
    .gap-pill{
      width: 100%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.10);
      color: var(--fg);
      font-size: 12.5px;
      font-weight: 700;
    }

    /* Legend */
    .legend{
      padding: 12px 14px;
      background: rgba(0,0,0,0.12);
      border-top: 1px solid rgba(255,255,255,0.06);
    }
    .legend-row{
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 6px;
    }
    .legend-label{
      font-size: 12px;
      color: var(--muted);
    }
    .swatch{
      width: 22px;
      height: 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
    }
    .s1{ background: rgba(20,20,30,0.55); }
    .s2{ background: rgba(124,58,237,0.18); }
    .s3{ background: rgba(124,58,237,0.28); }
    .s4{ background: rgba(168,85,247,0.30); }
    .s5{ background: rgba(233,213,255,0.34); }
    .legend-note{
      font-size: 12.5px;
      color: var(--muted);
      margin: 0;
      text-align: justify;
      text-justify: inter-word;
    }

    /* Reading */
    .dho-praticas-reading{
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 12px;
      align-items: start;
    }
    .reading-callout{
      display: grid;
      grid-template-columns: 10px 1fr;
      gap: 10px;
      align-items: start;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: linear-gradient(135deg, rgba(124,58,237,0.10), rgba(0,0,0,0.10));
      margin-top: 10px;
    }
    .callout-dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: rgba(233,213,255,0.45);
      margin-top: 6px;
      box-shadow: 0 0 0 4px rgba(168,85,247,0.12);
    }
    .callout-text{
      margin: 0;
      color: var(--sub);
    }

    /* Gaps list */
    .gaps-list{
      display: grid;
      gap: 10px;
      margin-top: 10px;
    }
    .gap-item{
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 12px;
      background: rgba(255,255,255,0.04);
      padding: 10px 12px;
    }
    .gap-top{
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
    }
    .gap-name{
      color: var(--fg);
      font-weight: 680;
      font-size: 13px;
      line-height: 1.25;
      text-align: left;
    }
    .gap-val{
      color: var(--fg);
      font-weight: 760;
      font-size: 12.5px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.10);
      white-space: nowrap;
    }
    .gap-desc{
      margin-top: 6px;
      font-size: 12.5px;
      color: var(--muted);
      text-align: justify;
      text-justify: inter-word;
    }
    .note{
      margin-top: 10px;
      font-size: 12.5px;
      color: var(--muted);
      text-align: justify;
      text-justify: inter-word;
    }

    /* Perspectives */
    .dho-praticas-perspectives{
      margin-top: 14px;
    }
    .persp-grid{
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    .mini{
      margin-top: 8px;
      color: var(--muted);
      font-size: 12.5px;
      text-align: justify;
      text-justify: inter-word;
    }

    /* Synth */
    .dho-praticas-synth{
      margin-top: 14px;
    }
    .synth-strip{
      display: grid;
      grid-template-columns: auto auto auto auto auto 1fr;
      gap: 10px;
      align-items: center;
      padding: 12px 14px;
      border: 1px solid var(--stroke);
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(124,58,237,0.10), rgba(0,0,0,0.12));
      box-shadow: 0 12px 28px rgba(0,0,0,.28);
    }
    .synth-step{
      display: grid;
      gap: 4px;
      align-items: start;
      padding: 8px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.10);
      min-width: 150px;
    }
    .synth-k{
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .06em;
      text-transform: uppercase;
    }
    .synth-v{
      font-size: 14px;
      color: var(--fg);
      font-weight: 760;
      text-align: left;
    }
    .synth-arrow{
      color: rgba(233,213,255,0.55);
      font-size: 18px;
      text-align: center;
      padding: 0 2px;
    }
    .synth-note p{
      margin: 0;
      color: var(--sub);
      font-size: 13px;
      text-align: justify;
      text-justify: inter-word;
    }

    /* Bridge + Reflection */
    .dho-praticas-bridge,
    .dho-praticas-reflection{
      margin-top: 14px;
      padding: 0;
    }
    .bridge-em{
      margin-top: 10px;
      display: grid;
      grid-template-columns: 18px 1fr;
      gap: 10px;
      align-items: start;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
    }
    .bridge-icon{
      color: rgba(233,213,255,0.60);
      font-size: 16px;
      margin-top: 2px;
    }
    .bridge-em p{
      margin: 0;
      color: var(--fg);
    }

    /* CTA */
    .dho-praticas-cta{
      margin-top: 14px;
    }

    /* Responsive */
    @media (max-width: 980px){
      .core-top{
        grid-template-columns: 1fr;
      }
      .view-toggle{
        justify-content: flex-start;
      }
      .dho-praticas-reading{
        grid-template-columns: 1fr;
      }
      .persp-grid{
        grid-template-columns: 1fr;
      }
      .heat-head,
      .heat-body .row{
        grid-template-columns: 1.4fr 0.65fr 0.8fr 0.75fr 0.55fr;
      }
      .synth-strip{
        grid-template-columns: 1fr;
      }
      .synth-arrow{ display: none; }
      .synth-step{ min-width: 0; }
    }

    @media (max-width: 640px){
      .dho-praticas-wrap{ padding: 0 14px; }
      .heat-th{ font-size: 11px; }
      .pratica{ font-size: 13px; }
      .heatbox{ padding: 8px 9px; }
      .heatbox .lab{ display: none; }
    }
  </style>

  <script>
    window.initBloco_praticas = function initBloco_praticas(){
      const DATA = {
        practices: [
          "1:1 e Feedback Estruturado",
          "Agenda de Equipe e Comunicação Interna",
          "Gestão Baseada em Dados (People Analytics)",
          "Gestão de Clima e Engajamento",
          "Gestão de Desempenho Contínuo",
          "Gestão por Competências",
          "Gestão por OKRs",
          "Liderança Situacional",
          "Mapeamento de Skills Críticas",
          "Mentoria e Desenvolvimento de Talentos",
          "Plano de Desenvolvimento Individual (PDI)"
        ],

        // Companhia atual: o quanto RH promove (1 a 5)
        rh_promove: [3,3,2,3,1,4,2,2,2,1,1],

        // Companhia atual: o quanto liderança aplica (1 a 5)
        lid_aplica: [3,4,3,4,3,3,4,3,3,3,3],

        // Trajetória: quanto conhece e já praticou (1 a 5)
        traj_neg: [5,5,4,5,5,5,5,5,5,5,5],
        traj_rh:  [5,4,4,4,5,4,3,5,3,3,4]
      };

      const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
      const avg = (a,b) => (a + b) / 2;

      // Escala visual 1..5 (leve, sutil, sem “neon forte”)
      function bgForValue(v){
        const x = clamp(v, 1, 5);
        // 1: quase preto / 5: lilás mais claro
        const map = {
          1: "rgba(20,20,30,0.55)",
          2: "rgba(124,58,237,0.18)",
          3: "rgba(124,58,237,0.28)",
          4: "rgba(168,85,247,0.30)",
          5: "rgba(233,213,255,0.34)"
        };
        return map[x];
      }

      const elHeat = document.getElementById("dho-praticas-heat");
      const elGaps = document.getElementById("dho-praticas-gaps");
      const elSynthRH = document.getElementById("synth-rh");
      const elSynthTraj = document.getElementById("synth-traj");
      const elSynthLid = document.getElementById("synth-lid");

      const toggles = Array.from(document.querySelectorAll(".dho-praticas .toggle-btn"));
      let view = "traj_avg"; // traj_avg | traj_neg | traj_rh

      function getTraj(i){
        if(view === "traj_neg") return DATA.traj_neg[i];
        if(view === "traj_rh") return DATA.traj_rh[i];
        return avg(DATA.traj_neg[i], DATA.traj_rh[i]);
      }

      function fmt(n){
        const v = Math.round(n * 10) / 10;
        return String(v).replace(".", ",");
      }

      function renderHeat(){
        if(!elHeat) return;
        elHeat.innerHTML = "";

        const rows = DATA.practices.map((name, i) => {
          const rh = DATA.rh_promove[i];
          const lid = DATA.lid_aplica[i];
          const t = getTraj(i);
          const gap = (t - lid);

          const row = document.createElement("div");
          row.className = "row";

          // Prática
          const c0 = document.createElement("div");
          c0.className = "cell";
          c0.innerHTML = '<div class="pratica">' + name + "</div>";

          // RH promove
          const c1 = document.createElement("div");
          c1.className = "cell";
          c1.innerHTML = `
            <div class="heatbox" style="background:${bgForValue(rh)}">
              <span class="lab">Nível</span>
              <span class="val">${rh}</span>
            </div>
          `;

          // Liderança aplica
          const c2 = document.createElement("div");
          c2.className = "cell";
          c2.innerHTML = `
            <div class="heatbox" style="background:${bgForValue(lid)}">
              <span class="lab">Nível</span>
              <span class="val">${lid}</span>
            </div>
          `;

          // Trajetória
          const c3 = document.createElement("div");
          c3.className = "cell";
          c3.innerHTML = `
            <div class="heatbox" style="background:${bgForValue(t)}">
              <span class="lab">Nível</span>
              <span class="val">${fmt(t)}</span>
            </div>
          `;

          // Gap
          const c4 = document.createElement("div");
          c4.className = "cell";
          const gapTxt = (gap >= 0 ? "+" : "") + fmt(gap);
          const gapBg = gap >= 2 ? "linear-gradient(135deg, rgba(233,213,255,0.18), rgba(124,58,237,0.10))" : "rgba(0,0,0,0.10)";
          c4.innerHTML = `<span class="gap-pill" style="background:${gapBg}">${gapTxt}</span>`;

          row.appendChild(c0);
          row.appendChild(c1);
          row.appendChild(c2);
          row.appendChild(c3);
          row.appendChild(c4);

          elHeat.appendChild(row);

          return { name, rh, lid, t, gap };
        });

        renderTopGaps(rows);
        renderSynthesis(rows);
      }

      function renderTopGaps(rows){
        if(!elGaps) return;
        const sorted = rows
          .slice()
          .sort((a,b) => (b.gap - a.gap))
          .slice(0, 4);

        elGaps.innerHTML = "";
        sorted.forEach(item => {
          const div = document.createElement("div");
          div.className = "gap-item";
          const gapTxt = (item.gap >= 0 ? "+" : "") + fmt(item.gap);

          // Texto editorial curto, sem julgamento
          const desc =
            item.gap >= 2
              ? "A prática é amplamente conhecida, mas perde força na rotina. Normalmente isso aponta falta de ritual, cadência e espaço na agenda."
              : "A prática tende a ser conhecida e aplicada em níveis próximos. Aqui, o ganho está mais em consistência do que em adoção.";

          div.innerHTML = `
            <div class="gap-top">
              <div class="gap-name">${item.name}</div>
              <div class="gap-val">Gap ${gapTxt}</div>
            </div>
            <div class="gap-desc">${desc}</div>
          `;
          elGaps.appendChild(div);
        });
      }

      function renderSynthesis(rows){
        const mean = arr => arr.reduce((s,x) => s + x, 0) / arr.length;

        const rhM = mean(rows.map(r => r.rh));
        const lidM = mean(rows.map(r => r.lid));
        const tM  = mean(rows.map(r => r.t));

        if(elSynthRH)  elSynthRH.textContent  = fmt(rhM) + " / 5";
        if(elSynthTraj) elSynthTraj.textContent = fmt(tM) + " / 5";
        if(elSynthLid) elSynthLid.textContent = fmt(lidM) + " / 5";
      }

      // Toggle handlers
      toggles.forEach(btn => {
        btn.addEventListener("click", () => {
          toggles.forEach(b => {
            b.classList.remove("is-active");
            b.setAttribute("aria-selected", "false");
          });
          btn.classList.add("is-active");
          btn.setAttribute("aria-selected", "true");
          view = btn.dataset.view || "traj_avg";
          renderHeat();
        });
      });

      // First render
      renderHeat();
    };
  </script>
</section>
